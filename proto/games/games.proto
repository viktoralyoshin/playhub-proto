syntax = "proto3";

package games;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/viktoralyoshin/playhub-proto/gen/go/games";

// ==========================================
// Service Definition
// ==========================================

service GameService {
    // Поиск игр.
    // Логика сервера:
    // 1. Ищет в локальной БД (Postgres) по совпадению названия.
    // 2. Если результатов мало или нет -> идет в IGDB API через IGDBManager::SearchGames.
    // 3. Сохраняет новые найденные игры в БД.
    // 4. Возвращает объединенный результат.
    rpc SearchGames (SearchGamesRequest) returns (GamesListResponse);

    // Получение детальной информации об игре.
    // Логика сервера:
    // 1. Ищет в БД по slug или id.
    // 2. Если нет -> запрашивает IGDB (нужен метод поиска по slug в IGDBManager, либо через Search).
    // 3. Если нашел -> сохраняет полную инфу в БД и отдает клиенту.
    rpc GetGame (GetGameRequest) returns (GetGameResponse);

    // Получение игр по жанру (использует IGDBManager::GetGamesByGenre + кэш)
    rpc GetGamesByGenre (GetGamesByGenreRequest) returns (GamesListResponse);

    // Получение топа игр (использует IGDBManager::GetTopRatedGames + кэш)
    rpc GetTopRatedGames (GetDiscoveryRequest) returns (GamesListResponse);

    // Получение ожидаемых игр (использует IGDBManager::GetUpcomingGames + кэш)
    rpc GetUpcomingGames (GetDiscoveryRequest) returns (GamesListResponse);
}

// ==========================================
// Request / Response Messages
// ==========================================

message SearchGamesRequest {
    // Поисковый запрос (например "Elden Ring" или "GTA")
    string query = 1;

    // Максимальное количество результатов (default: 10)
    uint32 limit = 2;
}

message GetGameRequest {
    // Мы позволяем искать игру либо по нашему UUID, либо по человеко-читаемому slug
    oneof id_type {
        string game_id = 1; // Внутренний UUID (из Postgres)
        string slug = 2;    // URL-friendly имя (например "the-witcher-3-wild-hunt")
    }
}

message GetGameResponse {
    Game game = 1;
}

message GetGamesByGenreRequest {
    // Название жанра (как в IGDB, например "Role-playing (RPG)")
    string genre_name = 1;
    uint32 limit = 2;
}

message GetDiscoveryRequest {
    // Лимит выдачи
    uint32 limit = 1;
}

message GamesListResponse {
    repeated Game games = 1;
}

// ==========================================
// Game Entity
// ==========================================

message Game {
    // Уникальный идентификатор игры в нашей системе (UUID string)
    string id = 1;
    
    // ID из IGDB API
    string igdb_id = 2;
    
    // Название игры
    string name = 3;
    
    // Человеко-читаемый идентификатор для URL
    string slug = 4;
    
    // Краткое описание
    string summary = 5;
    
    // Рейтинг от критиков (0-100)
    double igdb_rating = 6;

    double playhub_rating = 7;
    
    // Индекс ожидания/хайпа
    uint32 hypes = 8;
    
    // Дата первого релиза (строка, т.к. может быть неточной "2024")
    string first_release_date = 9;
    
    // Список всех дат релизов
    repeated string release_dates = 10;
    
    // URL обложки
    string cover_url = 11;
    
    // URL артов
    repeated string artwork_urls = 12;
    
    // URL скриншотов
    repeated string screenshots = 13;
    
    // Жанры (RPG, Shooter, etc.)
    repeated string genres = 14;
    
    // Темы (Fantasy, Sci-Fi)
    repeated string themes = 15;
    
    // Платформы (PC, PS5, Xbox)
    repeated string platforms = 16;
    
    // Когда запись создана в нашей БД
    google.protobuf.Timestamp created_at = 17;
    
    // Когда запись обновлена в нашей БД
    google.protobuf.Timestamp updated_at = 18;
}